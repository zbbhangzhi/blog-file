分布式系统

特点：副本形式分布在不同的网络计算机上，通过消息传递进行通信和协调系统

- 分布性：计算机随意分布
- 对等性：副本机制（数据副本但分主从服务；服务副本）
- 并发性：多客户端并发操作共享的数据资源
- 缺乏全局时钟：多个分布式计算机缺乏同一时间判断无法确认事件时序
- 故障总是会发生

问题

- 通信异常：网络不可用或通信延时导致消息丢失或延迟
- 网络分区：网络异常时，导致局部节点可用，形成小型的集群扛平时大集群处理的压力，可能导致分布式一致性问题
- 三态：成功，失败，超时（现象：1. 网络延时，消息没能成功发送给接收者，消息丢失 2. 接收方成功接收且完成业务处理后返回反馈给发送方时失败，消息丢失）消息发送方无法得知消息是否正确被处理
- 节点故障：某个节点宕机僵死等问题

分布式系统事务处理与数据一致性问题

- 事务的四个特征ACID：
  - 原子性Atomicity：事务执行由一条指令完成各项操作，要么成功要么失败，如果有一项操作失败，那么其他操作都被撤销
  - 一致性Consistency：事务执行前后数据库要保证数据的前后一致性
  - 隔离性Isolation：多个事务并发操作时保证一个事务不能被其他事务干扰
    - SQL规范中对事务隔离定义了4个级别，不同级别对于不同的事务处理，假设事务A正对字段A-A从1修改为10再改为20
      - 未授权读取：允许之前的事务还没提交时（读未提交），后面的事务对正在改变的值进行脏读，这个值可以是没变的值也可以是正在改变的值，会幻读，脏读-------1~20
      - 授权读取：只允许读已提交的数据，会幻读-------1，10，20
      - 可重复读取：禁止了不可重复读和脏读，但可能出现幻读；即两个时间段对同一数据（中间可能被其他事务改了，但是读的还是原来的值）然后改到数据库里就坏了。--------------1
      - 串行化：要求事务只能串行执行，不可并行执行---------不能访问
  - 持久性Durability；事务成功执行那么它执行的结果会被持久的存储，即使机器重启还是能恢复到这个值

但因为可用性和一致性之间可能出现冲突不能保证ACID完美实现，所以出现了如CAP,BASE等分布式理论

- CAP：分布式系统最多满足其中的两项特性
  - *一致性Consistency：多个副本保持一致性，在某个分布式机器上对数据做操作后，其他机器也都可以读到最新的值。
    - 强一致性：保留C
    - 最终一致性：放弃，不保证实时一致性但通过不同节点之间的复制数据最终会一个个都达到一致性状态
  - *可用性Availability：系统提供的服务一直处于可用状态，对于用户的请求服务能在有限时间内返回且返回正常的结果而不是系统异常等失败的结果
    - 放弃：可能导致故障机器在一段时间内不可用，无法正常对外提供服务
  - 分区容错性Partition tolerance：当某个网络分区（划分在一个子网络下的几个分布式机器，内部网络正常但是不能和其他子网络的机器通信而形成孤岛状态的孤立区域）下的分布式服务遇到网络故障时，其他网络分区下的机器仍然能够对外保持一致性和可用性的服务
    - 放弃：如果要避免P问题出现，只能将所有数据放在一个分布式节点上，避免网络分区问题；但同时意味着失去了可扩展性

- BASE：面向大型高可用扩展的分布式系统，基于CAP中一致性和可用性权衡的结果，使系统牺牲强一致性来获得可用性，做到最终一致性
  - 基本可用：分布式系统出现系统故障时，允许部分不可用，如响应时间延长，部分功能降级等
  - 弱状态：允许系统在不同节点的数据副本之间数据同步存在延时，即数据有中间状态但不影响系统整体的可用性
  - 最终一致性：保证系统数据最终保持一致即可而不是实时一致（比如关系型数据库异步延时同步）









